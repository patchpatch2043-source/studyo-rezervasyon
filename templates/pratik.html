<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pratik Anketi - Swing Planet</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; min-height: 100vh; }
        
        .header {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .header h1 { font-size: 18px; display: flex; align-items: center; gap: 10px; }
        .user-info { display: flex; align-items: center; gap: 15px; }
        .user-name { font-size: 14px; opacity: 0.9; }
        .admin-badge { background: #ffd700; color: #1a1a2e; padding: 3px 8px; border-radius: 12px; font-size: 11px; font-weight: 600; }
        .nav-btn { background: rgba(255,255,255,0.2); color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-size: 13px; text-decoration: none; margin-left: 10px; }
        
        .container { max-width: 900px; margin: 0 auto; padding: 20px; }
        
        .page-title { font-size: 24px; color: #1a1a2e; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        
        .anket-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); gap: 20px; }
        
        .anket-card {
            background: white;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .anket-card.kapali { opacity: 0.6; }
        
        .anket-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .anket-title { font-size: 20px; font-weight: 700; color: #1a1a2e; }
        .anket-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        .anket-badge.aktif { background: #e8f5e9; color: #2e7d32; }
        .anket-badge.kapali { background: #ffebee; color: #c62828; }
        
        .anket-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .anket-info-row { display: flex; gap: 10px; margin-bottom: 8px; font-size: 14px; color: #666; }
        .anket-info-row:last-child { margin-bottom: 0; }
        .anket-info-icon { width: 20px; text-align: center; }
        
        .oylama-section { margin-bottom: 20px; }
        .oylama-title { font-size: 14px; color: #666; margin-bottom: 10px; }
        .oylama-buttons { display: flex; gap: 10px; }
        .oylama-btn {
            flex: 1;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            background: white;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.2s;
        }
        .oylama-btn:hover:not(:disabled) { transform: scale(1.02); }
        .oylama-btn.evet { border-color: #4caf50; color: #2e7d32; }
        .oylama-btn.evet.selected { background: #4caf50; color: white; }
        .oylama-btn.hayir { border-color: #f44336; color: #c62828; }
        .oylama-btn.hayir.selected { background: #f44336; color: white; }
        .oylama-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .liste-section { margin-bottom: 20px; }
        .liste-title { font-size: 14px; color: #666; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
        .liste-count { background: #667eea; color: white; padding: 2px 8px; border-radius: 10px; font-size: 12px; }
        .liste-items { display: flex; flex-wrap: wrap; gap: 8px; }
        .liste-item {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
        }
        .liste-item.evet { background: #e8f5e9; color: #2e7d32; }
        .liste-item.hayir { background: #ffebee; color: #c62828; }
        .liste-empty { color: #999; font-size: 13px; font-style: italic; }
        
        .mesaj-section {
            background: #e8f5e9;
            border: 2px solid #4caf50;
            border-radius: 12px;
            padding: 15px;
        }
        .mesaj-title { font-size: 12px; color: #2e7d32; margin-bottom: 10px; font-weight: 600; }
        .mesaj-content {
            font-size: 14px;
            color: #1a1a2e;
            white-space: pre-wrap;
            line-height: 1.6;
        }
        .mesaj-copy {
            margin-top: 10px;
            padding: 8px 15px;
            background: #4caf50;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
        }
        .mesaj-copy:hover { background: #43a047; }
        
        .stats-link {
            display: block;
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            border-radius: 12px;
            font-weight: 600;
        }
        .stats-link:hover { opacity: 0.9; }
        
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: #323232;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            display: none;
            z-index: 1000;
        }
        .toast.success { background: #2e7d32; }
        .toast.error { background: #c62828; }
        
        .loading { text-align: center; padding: 40px; color: #999; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üíÉ Swing Planet</h1>
        <div class="user-info">
            <span class="user-name">{{ isim }}</span>
            {% if admin %}
            <span class="admin-badge">üëë Admin</span>
            <a href="/admin" class="nav-btn">‚öôÔ∏è Y√∂netim</a>
            {% endif %}
            <a href="/takvim" class="nav-btn">üìÖ Takvim</a>
            <a href="/logout" class="nav-btn">√áƒ±kƒ±≈ü</a>
        </div>
    </div>
    
    <div class="container">
        <h2 class="page-title">üó≥Ô∏è Pratik G√∂revli Anketi</h2>
        
        <div class="anket-grid" id="anket-grid">
            <div class="loading">Y√ºkleniyor...</div>
        </div>
        
        <a href="/pratik-istatistik" class="stats-link">üìä G√∂revli ƒ∞statistiklerini G√∂r√ºnt√ºle</a>
    </div>
    
    <div class="toast" id="toast"></div>
    
    <script>
        async function yukle() {
            try {
                const res = await fetch('/api/pratik/durum');
                const data = await res.json();
                
                const grid = document.getElementById('anket-grid');
                grid.innerHTML = '';
                
                const lokasyonlar = [
                    { key: 'sisli', baslik: 'üè¢ ≈ûi≈üli Bomonti', gun: '√áar≈üamba' },
                    { key: 'kadikoy', baslik: 'üåä Kadƒ±k√∂y', gun: 'Cuma' }
                ];
                
                lokasyonlar.forEach(lok => {
                    const d = data[lok.key];
                    const kapaliClass = d.aktif ? '' : 'kapali';
                    
                    let evetHtml = d.evet_listesi.length > 0 
                        ? d.evet_listesi.map(i => `<span class="liste-item evet">${i}</span>`).join('')
                        : '<span class="liste-empty">Hen√ºz kimse se√ßmedi</span>';
                    
                    let hayirHtml = d.hayir_listesi.length > 0
                        ? d.hayir_listesi.map(i => `<span class="liste-item hayir">${i}</span>`).join('')
                        : '<span class="liste-empty">Hen√ºz kimse se√ßmedi</span>';
                    
                    const evetSelected = d.kullanici_cevap === 'evet' ? 'selected' : '';
                    const hayirSelected = d.kullanici_cevap === 'hayir' ? 'selected' : '';
                    const disabled = d.aktif ? '' : 'disabled';
                    
                    grid.innerHTML += `
                        <div class="anket-card ${kapaliClass}">
                            <div class="anket-header">
                                <span class="anket-title">${lok.baslik}</span>
                                <span class="anket-badge ${d.aktif ? 'aktif' : 'kapali'}">
                                    ${d.aktif ? '‚úÖ Anket A√ßƒ±k' : 'üîí Anket Kapalƒ±'}
                                </span>
                            </div>
                            
                            <div class="anket-info">
                                <div class="anket-info-row">
                                    <span class="anket-info-icon">üìÖ</span>
                                    <span>${d.pratik_tarih_str}</span>
                                </div>
                                <div class="anket-info-row">
                                    <span class="anket-info-icon">üïê</span>
                                    <span>${d.saat}</span>
                                </div>
                                <div class="anket-info-row">
                                    <span class="anket-info-icon">üìç</span>
                                    <span>${d.yer}</span>
                                </div>
                            </div>
                            
                            <div class="oylama-section">
                                <div class="oylama-title">Bu ${lok.gun} pratik g√∂revlisi olmak ister misin?</div>
                                <div class="oylama-buttons">
                                    <button class="oylama-btn evet ${evetSelected}" onclick="oyla('${lok.key}', 'evet')" ${disabled}>
                                        ‚úÖ G√∂revli Olurum
                                    </button>
                                    <button class="oylama-btn hayir ${hayirSelected}" onclick="oyla('${lok.key}', 'hayir')" ${disabled}>
                                        ‚ùå Olamayacaƒüƒ±m
                                    </button>
                                </div>
                            </div>
                            
                            <div class="liste-section">
                                <div class="liste-title">
                                    G√∂revli Olacaklar
                                    <span class="liste-count">${d.evet_listesi.length}</span>
                                </div>
                                <div class="liste-items">${evetHtml}</div>
                            </div>
                            
                            <div class="liste-section">
                                <div class="liste-title">
                                    Olamayacaklar
                                    <span class="liste-count">${d.hayir_listesi.length}</span>
                                </div>
                                <div class="liste-items">${hayirHtml}</div>
                            </div>
                            
                            <div class="mesaj-section">
                                <div class="mesaj-title">üìã WhatsApp Mesajƒ± (Kopyala)</div>
                                <div class="mesaj-content" id="mesaj-${lok.key}">${d.mesaj}</div>
                                <button class="mesaj-copy" onclick="kopyala('${lok.key}')">üìã Mesajƒ± Kopyala</button>
                            </div>
                        </div>
                    `;
                });
                
            } catch (err) {
                console.error('Hata:', err);
                document.getElementById('anket-grid').innerHTML = '<p style="color:red;">Y√ºklenirken hata olu≈ütu</p>';
            }
        }
        
        async function oyla(lokasyon, cevap) {
            try {
                const res = await fetch('/api/pratik/oyla', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ lokasyon, cevap })
                });
                const data = await res.json();
                
                if (data.success) {
                    toast(data.mesaj, 'success');
                    yukle();
                } else {
                    toast(data.error, 'error');
                }
            } catch (err) {
                toast('Bir hata olu≈ütu', 'error');
            }
        }
        
        function kopyala(lokasyon) {
            const mesaj = document.getElementById('mesaj-' + lokasyon).textContent;
            navigator.clipboard.writeText(mesaj).then(() => {
                toast('Mesaj kopyalandƒ±!', 'success');
            }).catch(() => {
                toast('Kopyalama ba≈üarƒ±sƒ±z', 'error');
            });
        }
        
        function toast(mesaj, tip) {
            const t = document.getElementById('toast');
            t.textContent = mesaj;
            t.className = 'toast ' + (tip || '');
            t.style.display = 'block';
            setTimeout(() => { t.style.display = 'none'; }, 3000);
        }
        
        // Sayfa y√ºklendiƒüinde
        yukle();
        
        // Her 30 saniyede g√ºncelle
        setInterval(yukle, 30000);
    </script>
</body>
</html>
